import{r as e,o as t,a5 as n,H as o,K as s,_ as a,d as r,y as u,I as c,g as d,N as i,k as l,U as f,M as v,t as p,z as m,e as E,f as y,bX as w,q as L}from"./index.MfUVhhcS.js";function b(e){return void 0===e}const h="focus-trap.focus-after-trapped",T="focus-trap.focus-after-released",g={cancelable:!0,bubbles:!1},k={cancelable:!0,bubbles:!1},F="focusAfterTrapped",R="focusAfterReleased",K=Symbol("elFocusTrap"),N=e(),S=e(0),_=e(0);let P=0;const I=e=>{const t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:e=>{const t="INPUT"===e.tagName&&"hidden"===e.type;return e.disabled||e.hidden||t?NodeFilter.FILTER_SKIP:e.tabIndex>=0||e===document.activeElement?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)t.push(n.currentNode);return t},C=(e,t)=>{for(const n of e)if(!x(n,t))return n},x=(e,t)=>{if("hidden"===getComputedStyle(e).visibility)return!0;for(;e;){if(t&&e===t)return!1;if("none"===getComputedStyle(e).display)return!0;e=e.parentElement}return!1},A=(e,t)=>{if(e&&e.focus){const n=document.activeElement;e.focus({preventScroll:!0}),_.value=window.performance.now(),e!==n&&(e=>e instanceof HTMLInputElement&&"select"in e)(e)&&t&&e.select()}};function O(e,t){const n=[...e],o=e.indexOf(t);return-1!==o&&n.splice(o,1),n}const j=(()=>{let e=[];return{push:t=>{const n=e[0];n&&t!==n&&n.pause(),e=O(e,t),e.unshift(t)},remove:t=>{var n,o;e=O(e,t),null==(o=null==(n=e[0])?void 0:n.resume)||o.call(n)}}})(),q=()=>{N.value="pointer",S.value=window.performance.now()},B=()=>{N.value="keyboard",S.value=window.performance.now()},D=e=>new CustomEvent("focus-trap.focusout-prevented",{...k,detail:e});let H=[];const M=e=>{e.code===s.esc&&H.forEach((t=>t(e)))};var U=a(r({name:"ElFocusTrap",inheritAttrs:!1,props:{loop:Boolean,trapped:Boolean,focusTrapEl:Object,focusStartEl:{type:[Object,String],default:"first"}},emits:[F,R,"focusin","focusout","focusout-prevented","release-requested"],setup(a,{emit:r}){const l=e();let p,m;const{focusReason:E}=(t((()=>{0===P&&(document.addEventListener("mousedown",q),document.addEventListener("touchstart",q),document.addEventListener("keydown",B)),P++})),n((()=>{P--,P<=0&&(document.removeEventListener("mousedown",q),document.removeEventListener("touchstart",q),document.removeEventListener("keydown",B))})),{focusReason:N,lastUserFocusTimestamp:S,lastAutomatedFocusTimestamp:_});var y;y=e=>{a.trapped&&!w.paused&&r("release-requested",e)},t((()=>{0===H.length&&document.addEventListener("keydown",M),o&&H.push(y)})),n((()=>{H=H.filter((e=>e!==y)),0===H.length&&o&&document.removeEventListener("keydown",M)}));const w={paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}},L=e=>{if(!a.loop&&!a.trapped)return;if(w.paused)return;const{code:t,altKey:n,ctrlKey:o,metaKey:u,currentTarget:c,shiftKey:d}=e,{loop:i}=a,l=t===s.tab&&!n&&!o&&!u,f=document.activeElement;if(l&&f){const t=c,[n,o]=(e=>{const t=I(e);return[C(t,e),C(t.reverse(),e)]})(t);if(n&&o)if(d||f!==o){if(d&&[n,t].includes(f)){const t=D({focusReason:E.value});r("focusout-prevented",t),t.defaultPrevented||(e.preventDefault(),i&&A(o,!0))}}else{const t=D({focusReason:E.value});r("focusout-prevented",t),t.defaultPrevented||(e.preventDefault(),i&&A(n,!0))}else if(f===t){const t=D({focusReason:E.value});r("focusout-prevented",t),t.defaultPrevented||e.preventDefault()}}};u(K,{focusTrapRef:l,onKeydown:L}),c((()=>a.focusTrapEl),(e=>{e&&(l.value=e)}),{immediate:!0}),c([l],(([e],[t])=>{e&&(e.addEventListener("keydown",L),e.addEventListener("focusin",x),e.addEventListener("focusout",O)),t&&(t.removeEventListener("keydown",L),t.removeEventListener("focusin",x),t.removeEventListener("focusout",O))}));const b=e=>{r(F,e)},k=e=>r(R,e),x=e=>{const t=d(l);if(!t)return;const n=e.target,o=e.relatedTarget,s=n&&t.contains(n);if(!a.trapped){o&&t.contains(o)||(p=o)}s&&r("focusin",e),w.paused||a.trapped&&(s?m=n:A(m,!0))},O=e=>{const t=d(l);if(!w.paused&&t)if(a.trapped){const n=e.relatedTarget;i(n)||t.contains(n)||setTimeout((()=>{if(!w.paused&&a.trapped){const e=D({focusReason:E.value});r("focusout-prevented",e),e.defaultPrevented||A(m,!0)}}),0)}else{const n=e.target;n&&t.contains(n)||r("focusout",e)}};async function U(){await f();const e=d(l);if(e){j.push(w);const t=e.contains(document.activeElement)?p:document.activeElement;p=t;if(!e.contains(t)){const n=new Event(h,g);e.addEventListener(h,b),e.dispatchEvent(n),n.defaultPrevented||f((()=>{let n=a.focusStartEl;v(n)||(A(n),document.activeElement!==n&&(n="first")),"first"===n&&((e,t=!1)=>{const n=document.activeElement;for(const o of e)if(A(o,t),document.activeElement!==n)return})(I(e),!0),document.activeElement!==t&&"container"!==n||A(e)}))}}}function $(){const e=d(l);if(e){e.removeEventListener(h,b);const t=new CustomEvent(T,{...g,detail:{focusReason:E.value}});e.addEventListener(T,k),e.dispatchEvent(t),t.defaultPrevented||"keyboard"!=E.value&&S.value>_.value&&!e.contains(document.activeElement)||A(null!=p?p:document.body),e.removeEventListener(T,k),j.remove(w)}}return t((()=>{a.trapped&&U(),c((()=>a.trapped),(e=>{e?U():$()}))})),n((()=>{a.trapped&&$(),l.value&&(l.value.removeEventListener("keydown",L),l.value.removeEventListener("focusin",x),l.value.removeEventListener("focusout",O),l.value=void 0)})),{onKeydown:L}}}),[["render",function(e,t,n,o,s,a){return l(e.$slots,"default",{handleKeydown:e.onKeydown})}],["__file","focus-trap.vue"]]);const $=L(a(r({__name:"teleport",props:p({to:{type:m([String,Object]),required:!0},disabled:Boolean}),setup:e=>(e,t)=>e.disabled?l(e.$slots,"default",{key:0}):(E(),y(w,{key:1,to:e.to},[l(e.$slots,"default")],8,["to"]))}),[["__file","teleport.vue"]]));export{U as E,K as F,$ as a,b as i};
